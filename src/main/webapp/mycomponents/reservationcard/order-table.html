<link rel="import" href="../../../cwresources/components/polymer/polymer.html">

<link rel="import" href="../../../cwresources/components/paper-dialog/paper-dialog-transition.html">
<link rel="import" href="../../../cwresources/components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../../cwresources/components/core-ajax/core-ajax.html">
<link rel="import" href="../../../cwresources/components/paper-button/paper-button.html">
<link rel="import" href="../../../cwresources/components/paper-input/paper-input.html">
<link rel="import" href="../../../cwresources/components/paper-toast/paper-toast.html">
<link rel="import" href="../../../cwresources/components/paper-ripple/paper-ripple.html">
<polymer-element name="order-table" attributes="data columns itemcolumns sortColumn sortDescending shopitem">
    <template>
      <style>
      
     
    paper-dialog {
      width: 50%;
      min-width: 350px;
    }
    .c-form{
      width:90%;
      margin:24px auto 0;
    }
    .c-form paper-input{
      width:100%;
    }
      table.g_table {
		  width: 100%;
		  margin:0 auto;
		  border-collapse: collapse;
      }
      table.g_table tr:nth-of-type(even) {
		cursor: pointer;
		border-radius: 5px;
      }
    
      table.g_table td,
      table.g_table th {
		  padding: 0.75em 0;
		  margin: 0.3em 0;
		  text-align: left;
		  color: #616161;
		  font-size:14px;
      }
      table.g_table th {
		  font-weight: 800;
		  cursor: pointer;
		  color:#bdbdbd;
		  border-bottom:1px solid #bdbdbd;
		  padding-bottom:14px;
      }
      table.g_table td:first-of-type {
  		text-align: left;
      }
      table.g_table td{
      	border-bottom:1px solid #e0e0e0;
      }
      
      table.g_table td div{
      	border-bottom:1px solid #eeeeee;
      	padding:12px 0px;
      	margin:0px 12px;
      }
      
      table.g_table td div:last-child{
      	border-bottom:0px solid #eeeeee;
      }
      
      .p-select{
			width:100%;
			border:none;
			border:1px solid #757575;
			font-size:18px;
			color:#757575;
			background:none;
		}

		.p_file{
			font-size:18px;
			color:#757575;
			margin-top:8px;
		}
		.c-type{
		   font-size:18px;
			color:#757575;
			margin-bottom:12px;
		}
		
		 .c-p-caption{
		  padding: 12px;
		  display: block;
		  margin: 0.3em 0 0.6em 0;
		  cursor: pointer;
		  background: #e0e0e0;
		}

    </style>
    
   
    <paper-toast id="msgtoast" role="alert">
	 </paper-toast>
	  <div layout vertical center>
	  
	   <template if="{{data[0]==null}}">
	   <span style="color:#E91E63;line-height: 60px;font-weight: inherit;font-size: 40px;">暂无订单</span>
	   </template>
	  <template if="{{data[0]!=null}}">
      <table class="g_table">
        <tr>
          <template repeat="{{column in columns}}">
            <template if="{{column.title!='操作'}}">
            	<th on-click="{{changeSort}}" style="{{sortColumn==column.name ? (sortDescending ? 'text-decoration:overline' : 'text-decoration:underline') : ''}}">{{!(column.title) ? column.name : column.title}}</th>
            </template>
             <template if="{{column.title=='操作'}}">
             	<th colspan="2" on-click="{{changeSort}}" style="{{sortColumn==column.name ? (sortDescending ? 'text-decoration:overline' : 'text-decoration:underline') : ''}}">{{!(column.title) ? column.name : column.title}}</th>
             </template>
          </template>
        </tr>
        <template  repeat="{{row in data | sortByKey(sortColumn, sortDescending)}}">
          <template if="{{row['reservationStatus']==rowStatus}}">
          <tr>
            <template repeat="{{column in columns}}">
	            <template if="{{column.name!='action'&&column.name!='orderItems'}}">
	                <td>
	                  <span>{{row[column.name]}}</span>
	                </td>
	            </template>
	            <template if="{{column.name=='action'}}">
	                <td hidden?="{{row['reservationStatus']=='CANCELED'}}" on-click="{{editOrder}}"><paper-button label="修改订单" ></paper-button></td><td></td>
	             </template>
	             
	             <template if="{{column.name=='orderItems'}}">
	                <td>
	                 <template repeat="{{item in row[column.name]}}">
	                   <div>
	                 	<template repeat="{{icolumn in itemcolumns}}">
	                 	    <template if="{{icolumn.name=='imageLink'}}">
	                 	    <img style="width:40px;" src="{{'../../cwresources/'+item[icolumn.name]}}"/>
	                 		</template>
	                 		<template if="{{icolumn.name!='imageLink'}}">
	                 		{{icolumn.title}}:{{item[icolumn.name]}}
	                 		</template>
	                 	</template>
	                 	</div>
	                 </template>
	                 </td>
	            </template>
	         </template>
	         
             	
          </tr>
          </template>
          
          </template>
        </template>
      </table>
      </template>
      
      </div>
      
      
    </template>
    
    <script>
      PolymerExpressions.prototype.sortByKey = function(array, key, desc) {
          return array.sort(function(a, b) {
              var x = a[key];
              var y = b[key];

              if (typeof x == "string"){
                x = x.toLowerCase(); 
                y = y.toLowerCase();
              }
              if(desc){
                return ((x < y) ? 1 : ((x > y) ? -1 : 0));
              }else{
                return ((x < y) ? -1 : ((x > y) ? 1 : 0));
              }
          });
      };
      Polymer('order-table', {
          data: [],
          columns: [],
          itemcolumns:[],
          sortColumn: null,
          sortDescending: false,
          shopitem:null,
          cloneAll:function(obj){
          	var o;  
			    switch(typeof obj){  
			    case 'undefined': break;  
			    case 'string'   : o = obj + '';break;  
			    case 'number'   : o = obj - 0;break;  
			    case 'boolean'  : o = obj;break;  
			    case 'object'   :  
			        if(obj === null){  
			            o = null;  
			        }else{  
			            if(obj instanceof Array){  
			                o = [];  
			                for(var i = 0, len = obj.length; i < len; i++){  
			                    o.push(this.cloneAll(obj[i]));  
			                }  
			            }else{  
			                o = {};  
			                for(var k in obj){  
			                    o[k] = this.cloneAll(obj[k]);  
			                }  
			            }  
			        }  
			        break;  
			    default:          
			        o = obj;break;  
			    }  
			    return o;  
          },
          changeSort: function(e,p,o){
            var clickedSortColumn = o.templateInstance_.model.column.name;
            if(clickedSortColumn == this.sortColumn){
             
              this.sortDescending = !this.sortDescending;
            }else{
              this.sortColumn = clickedSortColumn;
            }
          },
          editOrder: function(e,p,o){
            var row=o.templateInstance_.model.row;
            this.shopitem=this.cloneAll(row);
            this.fire('editeorder-show');
          }
      });
    </script>
    
</polymer-element>

