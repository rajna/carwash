<link rel="import" href="../../../cwresources/components/polymer/polymer.html">

<link rel="import" href="../../../cwresources/components/core-ajax/core-ajax.html">
<link href="../../../cwresources/components/paper-button/paper-button.html" rel="import">
<link rel="import" href="../../../cwresources/components/paper-input/paper-input.html">


<polymer-element name="p-form" attributes="data columns sortColumn sortDescending">
    <template>
      <style>
    
    </style>
    
		<div class="c-form">
		<div class="f-inner">
		    <core-ajax id="ajax" 
		               handleAs="json"
		               url="../../api/product/post" 
		               params="{{product}}"
		               method="post">
		    </core-ajax>
		    
			<select class="p-select" selectedIndex={{product.categoryId}}>
					<option  name=1>1</option>
					<option  name=2>2</option>
					<option  name=3>3</option>
			</select>
			
			<paper-input label="名称" inputValue="{{product.name}}"
				placeholder="名称" floatingLabel></paper-input>
			<paper-input label="价格" min="0" inputValue="{{product.price}}"
				placeholder="价格" floatingLabel></paper-input>
			
			<paper-input label="描述" inputValue="{{product.description}}"
				placeholder="描述" floatingLabel></paper-input>
				
			<input type="file" inputValue="{{product.image}}" class="p_file" id="p_file" on-change="{{setFiles}}">
		</div>
	</div>

	<paper-button label="取消" affirmative></paper-button>
	<paper-button label="确定" affirmative autofocus class="p_confirm" on-click="{{upload}}" ></paper-button> 
    
    </template>
    
    <script>
      
      Polymer('p-form', {
          categories: {},
          product:{},
          setFiles: function(e, detail, sender) {
	        var formData = new FormData();
	
	        for (var i = 0, f; f = sender.files[i]; ++i) {
	          formData.append(sender.name, f, f.name);
	        }
	
	        this.$.ajax.body = formData;
	        // Override default type set by core-ajax.
	        // Allow browser to set the mime multipart content type itself. 
	        this.$.ajax.contentType = null;
	      },
	      upload: function(e, detail, sender) {
	        if (!this.$.p_file.files.length) {
	          alert('Please include a file');
	          return;
	        }
	        console.log(this.$.ajax.params);
	        this.$.ajax.go();
	      },
	      responseChanged: function() {
	        console.log('Response from server', this.response);
	      }
      });
    </script>
    
</polymer-element>

